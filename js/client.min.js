function guid(){var a=function a(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())}function send(d,c){var a=[];for(var b=0;b<c.length;b++){a.push(c[b][d]())}return a}var Gist=new function(){this.persist=function(b,a){localStorage.setItem(b,JSON.stringify({title:a.title,categories:send("toLowerCase",a.categories.split(/\s*,\s*/)),content:a.content,created_at:new Date()}));return localStorage.getItem(b)};this.search_by_category=function(e){var c=[];var b,d;console.log(localStorage.length);for(var a=0;a<localStorage.length;a++){b=localStorage.key(a);d=JSON.parse(localStorage.getItem(b));if(d.categories.indexOf(e.toLowerCase())!=-1){c.push(b)}}return c};this.display=function(a){item=JSON.parse(localStorage.getItem(a));item.created_at=new Date(item.created_at);updateCategories(item.categories);return"<li class='gist' data-key='"+a+"'>"+item.title.split(/\s+/).slice(0,3).join(" ").concat("...")+"<span class='date'> "+item.created_at.toLocaleDateString()+"(a las "+item.created_at.toLocaleTimeString()+")</span></li>"};this.setExample=function(){if(!localStorage.getItem("example")){this.persist("example",{title:"Ejemplo",categories:"examen, progra4",content:"Aquí _hay_ **markdown** y <pre><code>@notes.each{|n| puts n}</pre></code> `código`"})}}};function updateCategories(b){if(typeof b=="string"){b=send("toLowerCase",gist.categories.split(/\s*,\s*/))}for(var a=0;a<b.length;a++){if(!$("#categories option[value='"+b[a].toLowerCase()+"']").length){$("#categories").append("<option value='"+b[a]+"'>"+b[a]+"</option>")}}}function displayAll(){var c;var b;$("#gists").empty();for(var a=0;a<localStorage.length;a++){b=localStorage.key(a);$("#gists").append(Gist.display(b))}}$(function(){$("#display").hide();$("textarea").elastic();Gist.setExample();converter=new Showdown.converter();if(!Modernizr.localstorage){alert("Este browser no soporta html5, favor probar en otro")}if(localStorage.length>0){displayAll()}$(".gist").live("click",function(b){tgt=$(b.target);if(!tgt.is("li")){tgt=tgt.parent()}var a=JSON.parse(localStorage.getItem(tgt.data("key")));$("#edition").hide();$("#display").show();$("#note").html(converter.makeHtml(a.content));$("pre code",$("#display")).each(function(c,d){hljs.highlightBlock(d)})});$("[name='title']").focus(function(){$(".error").remove()});$("#edition").submit(function(b){b.preventDefault();if($("[name='title']").val()==""){$("[name='title']").before("<span class='error'>El título no puede estar en blanco</span>");return false}var a=guid();Gist.persist(a,{title:$("[name='title']").val(),categories:$("[name='categories']").val(),content:$("[name='content']").val()});$("#categories").val("Todas");displayAll();$("[name='title'], [name='categories'], [name='content']").val("")});$("#add").click(function(a){a.preventDefault();$("#edition").show();$("#display").hide()});$("#categories").change(function(){if($(this).val()=="Todas"){$("#prompt").text("Todas las notas");displayAll();return}$("#gists").empty();var a=Gist.search_by_category($(this).val());console.log(a);$("#prompt").text("Notas con la categoría '"+$(this).val()+"'");for(var b=0;b<a.length;b++){$("#gists").append(Gist.display(a[b]))}})});
/*
          Vos, que leés el código de las cosas porque no les tenés miedo, encontraste esto, así que te reto:
          resulta que este examen en realidad no requiere de ruby en el servidor, todo lo hice en javascript en el cliente.
          * La persistencia de objetos está hecha mediante localStorage (http://diveintohtml5.org/storage.html)
          * Les asigno llaves únicas mediante un guid (http://note19.com/2007/05/27/javascript-guid-generator/)
          * Ninguna url va a ningún lugar, todo es mediante javascript!
          * El parseo de markdown está hecho mediante showdown: http://attacklab.net/showdown/ (si lo bajás
          y ves los ejemplos, verás que es fácil de usar).
          * Y el coloreo de sintaxis está hecho mediante lo que usé en el tercer examen
          (http://softwaremaniacs.org/soft/highlight/en/description/)
          * Todo está manejado en los links y forms gracias a los eventos de jQuery y la función preventDefault().
          * El código fuente está aquí, minimizado, pero íntegro.
     */
